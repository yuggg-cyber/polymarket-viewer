<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket åšå¼ºç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen font-sans">

    <div id="app" class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- å¤´éƒ¨ -->
        <header class="mb-8 border-b border-gray-800 pb-6">
            <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400 mb-2">
                Polymarket å®æ—¶ç›˜å£
            </h1>
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 text-sm text-gray-400">
                <p>çº¯å‰ç«¯å¤šçº¿è·¯ä»£ç†æ¼”ç¤º</p>
                <div class="flex items-center gap-2">
                    <span :class="{'text-green-400': status === 'success', 'text-yellow-400': status === 'loading', 'text-red-400': status === 'error'}">
                        â— {{ statusText }}
                    </span>
                </div>
            </div>
        </header>

        <!-- é”™è¯¯é¢æ¿ -->
        <div v-if="error" class="bg-red-900/20 border border-red-500/30 rounded-lg p-6 mb-8 text-center">
            <div class="text-3xl mb-2">ğŸ˜­</div>
            <h3 class="text-red-400 font-bold mb-2">æ‰€æœ‰çº¿è·¯å‡è¢«æ‹¦æˆª</h3>
            <p class="text-gray-400 text-sm mb-4">{{ error }}</p>
            <p class="text-xs text-gray-500 max-w-2xl mx-auto">
                åŸå› ï¼šPolymarket çš„é˜²ç«å¢™éå¸¸ä¸¥æ ¼ï¼Œå…¬å…±ä»£ç†æœåŠ¡å™¨ï¼ˆå¦‚ AllOrigins/CodeTabsï¼‰çš„ IP å¯èƒ½å·²è¢«ä¸´æ—¶å°ç¦ã€‚è¿™æ˜¯çº¯å‰ç«¯æ— æœåŠ¡å™¨æ¶æ„çš„å¤©ç„¶å±€é™ã€‚
            </p>
            <button @click="retry" class="mt-4 px-6 py-2 bg-red-600 hover:bg-red-500 text-white rounded-full transition-colors">
                å†è¯•ä¸€æ¬¡
            </button>
        </div>

        <!-- æ•°æ®åˆ—è¡¨ -->
        <div v-if="markets.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            <div v-for="market in markets" :key="market.condition_id" 
                 class="bg-gray-800 rounded-xl p-5 border border-gray-700 hover:border-blue-500/50 transition-all hover:shadow-lg hover:shadow-blue-900/20 group">
                
                <div class="flex justify-between items-start mb-3">
                    <span class="text-xs font-mono bg-gray-700 text-gray-300 px-2 py-1 rounded">
                        {{ market.active ? 'ACTIVE' : 'CLOSED' }}
                    </span>
                    <!-- æ˜¾ç¤ºä»£å¸å›¾æ ‡ï¼ˆå¦‚æœæœ‰ï¼‰ -->
                    <div class="text-xs text-gray-500">ID: {{ market.asset_id?.substring(0,6) }}...</div>
                </div>

                <h3 class="font-medium text-lg leading-snug mb-4 group-hover:text-blue-300 transition-colors">
                    <a :href="'https://polymarket.com/event/' + market.market_slug" target="_blank">
                        {{ market.question }}
                    </a>
                </h3>

                <!-- ä»·æ ¼æ¡ï¼ˆå¦‚æœæœ‰ tokensï¼‰ -->
                <div v-if="market.tokens" class="space-y-2">
                    <div v-for="(token, idx) in market.tokens" :key="idx" class="flex justify-between items-center text-sm">
                        <span class="text-gray-400">{{ token.outcome }}</span>
                        <span class="font-bold font-mono" :class="token.price > 0.5 ? 'text-green-400' : 'text-blue-400'">
                            {{ (token.price * 100).toFixed(1) }}Â¢
                        </span>
                    </div>
                </div>
                <div v-else class="text-sm text-gray-500 italic">
                    æš‚æ— å®æ—¶ä»·æ ¼æ•°æ®
                </div>

                <div class="mt-4 pt-4 border-t border-gray-700/50 text-right">
                    <a :href="'https://polymarket.com/event/' + market.market_slug" target="_blank"
                       class="inline-flex items-center text-xs text-blue-400 hover:text-blue-300">
                        å»äº¤æ˜“ <span class="ml-1 text-lg">â†’</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- åŠ è½½éª¨æ¶å± -->
        <div v-if="status === 'loading' && markets.length === 0" class="grid grid-cols-1 md:grid-cols-3 gap-5">
            <div v-for="i in 6" :key="i" class="bg-gray-800 h-48 rounded-xl animate-pulse"></div>
        </div>

    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const markets = ref([]);
                const status = ref('idle'); // idle, loading, success, error
                const statusText = ref('å‡†å¤‡å°±ç»ª');
                const error = ref(null);

                // å®šä¹‰ä»£ç†åˆ—è¡¨ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰
                // 1. CodeTabs: é€šå¸¸æ¯”è¾ƒç¨³
                // 2. CorsProxy.io: é€Ÿåº¦å¿«ä½†å®¹æ˜“è¢«å±è”½
                // 3. AllOrigins: ä½ çš„ä¸Šä¸€æ¬¡å°è¯•ï¼Œä½œä¸ºä¿åº•
                const PROXIES = [
                    { name: 'CodeTabs', url: url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}` },
                    { name: 'CorsProxy', url: url => `https://corsproxy.io/?${encodeURIComponent(url)}` },
                    { name: 'AllOrigins', url: url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}` }
                ];

                const fetchWithRetry = async () => {
                    status.value = 'loading';
                    error.value = null;
                    markets.value = [];

                    // ç›®æ ‡ï¼šPolymarket CLOB API
                    const targetUrl = 'https://clob.polymarket.com/markets?active=true&limit=15&closed=false';

                    for (const proxy of PROXIES) {
                        try {
                            statusText.value = `æ­£åœ¨å°è¯•çº¿è·¯: ${proxy.name}...`;
                            console.log(`Trying proxy: ${proxy.name}`);
                            
                            // æ„é€ æœ€ç»ˆè¯·æ±‚åœ°å€
                            const finalUrl = proxy.url(targetUrl);
                            
                            // å‘é€è¯·æ±‚ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 8 ç§’
                            const response = await axios.get(finalUrl, { timeout: 8000 });

                            // éªŒè¯æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®
                            let data = response.data;
                            
                            // æŸäº›ä»£ç†ä¼šæŠŠæ•°æ®åŒ…ä¸€å±‚ï¼Œåšç®€å•å¤„ç†
                            if (data.contents) data = JSON.parse(data.contents); // AllOrigins æœ‰æ—¶è¿”å› contents å­—æ®µ
                            
                            // CLOB API è¿”å›ç»“æ„é€šå¸¸æ˜¯ { data: [...] } æˆ–ç›´æ¥ [...]
                            const items = Array.isArray(data) ? data : (data.data || []);

                            if (items.length > 0) {
                                markets.value = items;
                                status.value = 'success';
                                statusText.value = `åŠ è½½æˆåŠŸ (çº¿è·¯: ${proxy.name})`;
                                return; // æˆåŠŸäº†ï¼ç›´æ¥é€€å‡ºå‡½æ•°
                            } else {
                                throw new Error("è¿”å›æ•°æ®ä¸ºç©º");
                            }

                        } catch (err) {
                            console.warn(`${proxy.name} failed:`, err.message);
                            // ç»§ç»­å¾ªç¯ï¼Œå°è¯•ä¸‹ä¸€ä¸ªä»£ç†
                        }
                    }

                    // å¦‚æœå¾ªç¯ç»“æŸè¿˜æ²¡ returnï¼Œè¯´æ˜å…¨å¤±è´¥äº†
                    status.value = 'error';
                    statusText.value = 'è¿æ¥å¤±è´¥';
                    error.value = `å°è¯•äº† ${PROXIES.length} ä¸ªä»£ç†çº¿è·¯ï¼Œå‡æœªèƒ½è·å–æ•°æ®ã€‚å¯èƒ½æ˜¯ GitHub Pages çš„å‡ºå£ IP æ®µå·²è¢«æš‚æ—¶é™åˆ¶ã€‚`;
                };

                const retry = () => {
                    fetchWithRetry();
                };

                onMounted(() => {
                    fetchWithRetry();
                });

                return {
                    markets,
                    status,
                    statusText,
                    error,
                    retry
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
