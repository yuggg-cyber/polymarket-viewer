<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket é¢„æµ‹ç›˜ (CLOBç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-100 min-h-screen">

    <div id="app" class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold bg-gradient-to-r from-green-400 to-blue-500 bg-clip-text text-transparent">
                Polymarket æ¢ç´¢è€…
            </h1>
            <p class="text-slate-400 text-sm mt-1">æ•°æ®æºï¼šOfficial CLOB API (REST) | ä»£ç†ï¼šAllOrigins</p>
            
            <!-- çŠ¶æ€æ  -->
            <div class="mt-4 h-6">
                <div v-if="loading" class="text-blue-400 flex items-center text-sm animate-pulse">
                    <svg class="animate-spin h-4 w-4 mr-2" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    æ­£åœ¨ä» CLOB API æ‹‰å–æ•°æ®...
                </div>
                <div v-else class="text-slate-500 text-sm">
                    å·²åŠ è½½ {{ markets.length }} ä¸ªæ´»è·ƒé¢„æµ‹ç›˜
                </div>
            </div>
        </header>

        <!-- é”™è¯¯æç¤º -->
        <div v-if="error" class="bg-red-900/30 border border-red-500/50 text-red-200 p-4 rounded-lg mb-6 text-sm">
            <p class="font-bold">å‡ºé”™äº†ï¼š</p>
            <p>{{ error }}</p>
            <button @click="fetchMarkets" class="mt-2 px-3 py-1 bg-red-800 hover:bg-red-700 rounded text-xs">é‡è¯•</button>
        </div>

        <!-- åˆ—è¡¨ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div v-for="market in markets" :key="market.condition_id" 
                 class="bg-slate-800 border border-slate-700 rounded-xl p-5 hover:border-green-500/50 transition-all shadow-lg flex flex-col h-full">
                
                <!-- å›¾æ ‡(éšæœºé¢œè‰²æ›¿ä»£)ä¸æ ‡é¢˜ -->
                <div class="flex gap-4 mb-4 flex-grow">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-slate-700 to-slate-600 flex-shrink-0 flex items-center justify-center text-xl">
                        ğŸ²
                    </div>
                    <h3 class="font-semibold text-gray-100 leading-snug line-clamp-3">
                        {{ market.question }}
                    </h3>
                </div>

                <!-- åº•éƒ¨ä¿¡æ¯ -->
                <div class="pt-4 border-t border-slate-700/50 flex justify-between items-center text-xs">
                    <!-- CLOB API ä¸ç›´æ¥è¿”å›å›¾ç‰‡å’Œ24häº¤æ˜“é‡ï¼Œæˆ‘ä»¬æ˜¾ç¤ºåŸºç¡€ä¿¡æ¯ -->
                    <div class="text-slate-400">
                        <span v-if="market.active" class="text-green-400 mr-2">â— è¿›è¡Œä¸­</span>
                        <span v-else class="text-red-400 mr-2">â— å·²ç»“æŸ</span>
                    </div>
                    
                    <a :href="'https://polymarket.com/event/' + market.market_slug" 
                       target="_blank"
                       class="text-blue-400 hover:text-blue-300 font-medium">
                        æŸ¥çœ‹è¯¦æƒ… &rarr;
                    </a>
                </div>
            </div>
        </div>
        
         <!-- ç¿»é¡µ/åŠ è½½æ›´å¤š -->
         <div class="text-center mt-8 pb-8">
            <button @click="loadMore" v-if="nextCursor" :disabled="loading"
                class="px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-full text-sm transition-colors disabled:opacity-50">
                {{ loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š' }}
            </button>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const markets = ref([]);
                const loading = ref(false);
                const error = ref(null);
                const nextCursor = ref(null); // ç”¨äºç¿»é¡µ

                // æ ¸å¿ƒå‡½æ•°ï¼šä½¿ç”¨ CLOB API + AllOrigins ä»£ç†
                const fetchMarkets = async (isLoadMore = false) => {
                    if (loading.value) return;
                    loading.value = true;
                    error.value = null;

                    try {
                        // 1. æ„é€  Polymarket CLOB API åœ°å€
                        // limit: æ¯æ¬¡è·å–20æ¡
                        // active: true åªçœ‹æ´»è·ƒçš„
                        let apiUrl = `https://clob.polymarket.com/markets?active=true&limit=20`;
                        
                        // å¦‚æœæ˜¯ç¿»é¡µï¼ŒåŠ ä¸Š cursor å‚æ•°
                        if (isLoadMore && nextCursor.value) {
                            apiUrl += `&next_cursor=${nextCursor.value}`;
                        }

                        // 2. ä½¿ç”¨ AllOrigins ä»£ç† (ä¸“é—¨å¤„ç† GET è¯·æ±‚è·¨åŸŸ)
                        // æˆ‘ä»¬åŠ ä¸Š &t=æ—¶é—´æˆ³ é˜²æ­¢ç¼“å­˜
                        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}&t=${new Date().getTime()}`;

                        // 3. å‘é€ GET è¯·æ±‚
                        const response = await axios.get(proxyUrl);

                        // 4. å¤„ç†æ•°æ® (CLOB API çš„ç»“æ„ä¸ Gamma API ä¸åŒ)
                        // CLOB è¿”å›æ ¼å¼: { data: [...], next_cursor: "..." }
                        const resultData = response.data;
                        
                        if (Array.isArray(resultData.data)) {
                            if (isLoadMore) {
                                markets.value = [...markets.value, ...resultData.data];
                            } else {
                                markets.value = resultData.data;
                            }
                            // æ›´æ–°ç¿»é¡µæ¸¸æ ‡
                            nextCursor.value = resultData.next_cursor || null;
                        } else if (Array.isArray(resultData)) {
                            // å…¼å®¹æŸäº›æ—§æ ¼å¼è¿”å›
                            markets.value = resultData;
                        }

                    } catch (err) {
                        console.error("è¯·æ±‚å¤±è´¥è¯¦æƒ…:", err);
                        error.value = "æ— æ³•è¿æ¥åˆ°æ•°æ®æºã€‚è¯·æ£€æŸ¥ç½‘ç»œï¼Œæˆ–ç¨ååˆ·æ–°é‡è¯•ã€‚(" + err.message + ")";
                    } finally {
                        loading.value = false;
                    }
                };

                const loadMore = () => {
                    fetchMarkets(true);
                };

                onMounted(() => {
                    fetchMarkets();
                });

                return {
                    markets,
                    loading,
                    error,
                    nextCursor,
                    fetchMarkets,
                    loadMore
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
